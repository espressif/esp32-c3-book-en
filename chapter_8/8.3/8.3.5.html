<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Bluetooth Protocol - ESP32-C3 Wireless Adventure A comprehensive guide to IoT</title>
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="A comprehensive guide to IoT">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="../../favicon.svg">
                        <link rel="shortcut icon" href="../../favicon.png">
                <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
                <link rel="stylesheet" href="../../css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="../../fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
                <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../introduction.html">Introduction</a></li><li class="chapter-item expanded affix "><a href="../../preface/authors_note.html">Author‚Äôs Note</a></li><li class="chapter-item expanded affix "><a href="../../preface/how_to_use.html">How to use this book?</a></li><li class="chapter-item expanded affix "><li class="part-title">Preparation</li><li class="chapter-item expanded "><a href="../../chapter_1/index.html"><strong aria-hidden="true">1.</strong> Introduction to IoT</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_1/1.1.html"><strong aria-hidden="true">1.1.</strong> Architecture of IoT</a></li><li class="chapter-item expanded "><a href="../../chapter_1/1.2.html"><strong aria-hidden="true">1.2.</strong> IoT Application in Smart Homes</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_2/index.html"><strong aria-hidden="true">2.</strong> Introduction and Practice of IoT Projects</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_2/2.1/index.html"><strong aria-hidden="true">2.1.</strong> Introduction to Typical IoT Projects</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_2/2.1/2.1.1.html"><strong aria-hidden="true">2.1.1.</strong> Basic Modules for Common IoT Devices</a></li><li class="chapter-item expanded "><a href="../../chapter_2/2.1/2.1.2.html"><strong aria-hidden="true">2.1.2.</strong> Basic Modules of Client Applications</a></li><li class="chapter-item expanded "><a href="../../chapter_2/2.1/2.1.3.html"><strong aria-hidden="true">2.1.3.</strong> Introduction to Common IoT Cloud Platforms</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_2/2.2/index.html"><strong aria-hidden="true">2.2.</strong> üßê Practice: Smart Light Project</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_2/2.2/2.2.1.html"><strong aria-hidden="true">2.2.1.</strong> Project Structure</a></li><li class="chapter-item expanded "><a href="../../chapter_2/2.2/2.2.2.html"><strong aria-hidden="true">2.2.2.</strong> Project Functions</a></li><li class="chapter-item expanded "><a href="../../chapter_2/2.2/2.2.3.html"><strong aria-hidden="true">2.2.3.</strong> Hardware Preparation</a></li><li class="chapter-item expanded "><a href="../../chapter_2/2.2/2.2.4.html"><strong aria-hidden="true">2.2.4.</strong> Development Process</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_2/summary.html"><strong aria-hidden="true">2.3.</strong> Summary</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_3/index.html"><strong aria-hidden="true">3.</strong> Introduction to ESP RainMaker</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_3/3.1.html"><strong aria-hidden="true">3.1.</strong> What is ESP RainMaker?</a></li><li class="chapter-item expanded "><a href="../../chapter_3/3.2/index.html"><strong aria-hidden="true">3.2.</strong> The Implementation of ESP RainMaker</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_3/3.2/3.2.1.html"><strong aria-hidden="true">3.2.1.</strong> Claiming Service</a></li><li class="chapter-item expanded "><a href="../../chapter_3/3.2/3.2.2.html"><strong aria-hidden="true">3.2.2.</strong> RainMaker Agent</a></li><li class="chapter-item expanded "><a href="../../chapter_3/3.2/3.2.3.html"><strong aria-hidden="true">3.2.3.</strong> Cloud Backend</a></li><li class="chapter-item expanded "><a href="../../chapter_3/3.2/3.2.4.html"><strong aria-hidden="true">3.2.4.</strong> RainMaker Client</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_3/3.3.html"><strong aria-hidden="true">3.3.</strong> üßê Practice: Key Points for Developing with ESP RainMaker</a></li><li class="chapter-item expanded "><a href="../../chapter_3/3.4/index.html"><strong aria-hidden="true">3.4.</strong> Features of ESP RainMaker</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_3/3.4/3.4.1.html"><strong aria-hidden="true">3.4.1.</strong> User Management</a></li><li class="chapter-item expanded "><a href="../../chapter_3/3.4/3.4.2.html"><strong aria-hidden="true">3.4.2.</strong> End User Features</a></li><li class="chapter-item expanded "><a href="../../chapter_3/3.4/3.4.3.html"><strong aria-hidden="true">3.4.3.</strong> Admin Features</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_3/summary.html"><strong aria-hidden="true">3.5.</strong> Summary</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_4/index.html"><strong aria-hidden="true">4.</strong> Setting Up Development Environment</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_4/4.1/index.html"><strong aria-hidden="true">4.1.</strong> ESP-IDF Overview</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_4/4.1/4.1.1.html"><strong aria-hidden="true">4.1.1.</strong> ESP-IDF Versions</a></li><li class="chapter-item expanded "><a href="../../chapter_4/4.1/4.1.2.html"><strong aria-hidden="true">4.1.2.</strong> ESP-IDF Git Workflow</a></li><li class="chapter-item expanded "><a href="../../chapter_4/4.1/4.1.3.html"><strong aria-hidden="true">4.1.3.</strong> Choosing a Suitable Version</a></li><li class="chapter-item expanded "><a href="../../chapter_4/4.1/4.1.4.html"><strong aria-hidden="true">4.1.4.</strong> Overview of ESP-IDF SDK Directory</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_4/4.2/index.html"><strong aria-hidden="true">4.2.</strong> Setting Up ESP-IDF Development Environment</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_4/4.2/4.2.1.html"><strong aria-hidden="true">4.2.1.</strong> Setting up ESP-IDF Development Environment on Linux</a></li><li class="chapter-item expanded "><a href="../../chapter_4/4.2/4.2.2.html"><strong aria-hidden="true">4.2.2.</strong> Setting up ESP-IDF Development Environment on Windows</a></li><li class="chapter-item expanded "><a href="../../chapter_4/4.2/4.2.3.html"><strong aria-hidden="true">4.2.3.</strong> Setting up ESP-IDF Development Environment on Mac</a></li><li class="chapter-item expanded "><a href="../../chapter_4/4.2/4.2.4.html"><strong aria-hidden="true">4.2.4.</strong> Installing VS Code</a></li><li class="chapter-item expanded "><a href="../../chapter_4/4.2/4.2.5.html"><strong aria-hidden="true">4.2.5.</strong> Introduction to Third-Party Development Environments</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_4/4.3/index.html"><strong aria-hidden="true">4.3.</strong> ESP-IDF Compilation System</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_4/4.3/4.3.1.html"><strong aria-hidden="true">4.3.1.</strong> Basic Concepts of Compilation System</a></li><li class="chapter-item expanded "><a href="../../chapter_4/4.3/4.3.2.html"><strong aria-hidden="true">4.3.2.</strong> Project File Structure</a></li><li class="chapter-item expanded "><a href="../../chapter_4/4.3/4.3.3.html"><strong aria-hidden="true">4.3.3.</strong> Default Build Rules of the Compilation System</a></li><li class="chapter-item expanded "><a href="../../chapter_4/4.3/4.3.4.html"><strong aria-hidden="true">4.3.4.</strong> Introduction to the Compilation Script</a></li><li class="chapter-item expanded "><a href="../../chapter_4/4.3/4.3.5.html"><strong aria-hidden="true">4.3.5.</strong> Introduction to Common Commands</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_4/4.4/index.html"><strong aria-hidden="true">4.4.</strong> üßê Practice: Compiling Example Program ‚ÄúBlink‚Äù</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_4/4.4/4.4.1.html"><strong aria-hidden="true">4.4.1.</strong> Example Analysis</a></li><li class="chapter-item expanded "><a href="../../chapter_4/4.4/4.4.2.html"><strong aria-hidden="true">4.4.2.</strong> Compiling the Blink Program</a></li><li class="chapter-item expanded "><a href="../../chapter_4/4.4/4.4.3.html"><strong aria-hidden="true">4.4.3.</strong> Flashing the Blink Program</a></li><li class="chapter-item expanded "><a href="../../chapter_4/4.4/4.4.4.html"><strong aria-hidden="true">4.4.4.</strong> Serial Port Log Analysis of the Blink Program</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_4/summary.html"><strong aria-hidden="true">4.5.</strong> Summary</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Hardware and Driver Development</li><li class="chapter-item expanded "><a href="../../chapter_5/index.html"><strong aria-hidden="true">5.</strong> Hardware Design of Smart Light Products based on ESP32-C3</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_5/5.1.html"><strong aria-hidden="true">5.1.</strong> Features and Composition of Smart Light Products</a></li><li class="chapter-item expanded "><a href="../../chapter_5/5.2/index.html"><strong aria-hidden="true">5.2.</strong> Hardware Design of ESP32-C3 Core System</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_5/5.2/5.2.1.html"><strong aria-hidden="true">5.2.1.</strong> Power Supply</a></li><li class="chapter-item expanded "><a href="../../chapter_5/5.2/5.2.2.html"><strong aria-hidden="true">5.2.2.</strong> Power-on Sequence and System Reset</a></li><li class="chapter-item expanded "><a href="../../chapter_5/5.2/5.2.3.html"><strong aria-hidden="true">5.2.3.</strong> SPI Flash</a></li><li class="chapter-item expanded "><a href="../../chapter_5/5.2/5.2.4.html"><strong aria-hidden="true">5.2.4.</strong> Clock Source</a></li><li class="chapter-item expanded "><a href="../../chapter_5/5.2/5.2.5.html"><strong aria-hidden="true">5.2.5.</strong> RF and Antenna</a></li><li class="chapter-item expanded "><a href="../../chapter_5/5.2/5.2.6.html"><strong aria-hidden="true">5.2.6.</strong> Strapping Pins</a></li><li class="chapter-item expanded "><a href="../../chapter_5/5.2/5.2.7.html"><strong aria-hidden="true">5.2.7.</strong> GPIO and PWM Controller</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_5/5.3/index.html"><strong aria-hidden="true">5.3.</strong> üßê Practice: Building a Smart Light System with ESP32-C3</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_5/5.3/5.3.1.html"><strong aria-hidden="true">5.3.1.</strong> Selecting Modules</a></li><li class="chapter-item expanded "><a href="../../chapter_5/5.3/5.3.2.html"><strong aria-hidden="true">5.3.2.</strong> Configuring GPIOs of PWM Signals</a></li><li class="chapter-item expanded "><a href="../../chapter_5/5.3/5.3.3.html"><strong aria-hidden="true">5.3.3.</strong> Downloading Firmware and Debugging Interface</a></li><li class="chapter-item expanded "><a href="../../chapter_5/5.3/5.3.4.html"><strong aria-hidden="true">5.3.4.</strong> Guidelines for RF Design</a></li><li class="chapter-item expanded "><a href="../../chapter_5/5.3/5.3.5.html"><strong aria-hidden="true">5.3.5.</strong> Guidelines for Power Supply Design</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_5/summary.html"><strong aria-hidden="true">5.4.</strong> Summary</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_6/index.html"><strong aria-hidden="true">6.</strong> Driver Development</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_6/6.1.html"><strong aria-hidden="true">6.1.</strong> Driver Development Process</a></li><li class="chapter-item expanded "><a href="../../chapter_6/6.2.html"><strong aria-hidden="true">6.2.</strong> ESP32-C3 Peripheral Applications</a></li><li class="chapter-item expanded "><a href="../../chapter_6/6.3/index.html"><strong aria-hidden="true">6.3.</strong> LED Driver Basics</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_6/6.3/6.3.1.html"><strong aria-hidden="true">6.3.1.</strong> Color Spaces</a></li><li class="chapter-item expanded "><a href="../../chapter_6/6.3/6.3.2.html"><strong aria-hidden="true">6.3.2.</strong> LED Driver</a></li><li class="chapter-item expanded "><a href="../../chapter_6/6.3/6.3.3.html"><strong aria-hidden="true">6.3.3.</strong> LED Dimming</a></li><li class="chapter-item expanded "><a href="../../chapter_6/6.3/6.3.4.html"><strong aria-hidden="true">6.3.4.</strong> Introduction to PWM</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_6/6.4/index.html"><strong aria-hidden="true">6.4.</strong> LED Dimming Driver Development</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_6/6.4/6.4.1.html"><strong aria-hidden="true">6.4.1.</strong> Non-Volatile Storage (NVS)</a></li><li class="chapter-item expanded "><a href="../../chapter_6/6.4/6.4.2.html"><strong aria-hidden="true">6.4.2.</strong> LED PWM Controller (LEDC)</a></li><li class="chapter-item expanded "><a href="../../chapter_6/6.4/6.4.3.html"><strong aria-hidden="true">6.4.3.</strong> LED PWM Programming</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_6/6.5/index.html"><strong aria-hidden="true">6.5.</strong> üßê Practice: Adding Drivers to Smart Light Project</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_6/6.5/6.5.1.html"><strong aria-hidden="true">6.5.1.</strong> Button Driver</a></li><li class="chapter-item expanded "><a href="../../chapter_6/6.5/6.5.2.html"><strong aria-hidden="true">6.5.2.</strong> LED Dimming Driver</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_6/summary.html"><strong aria-hidden="true">6.6.</strong> Summary</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Wireless Communication and Control</li><li class="chapter-item expanded "><a href="../../chapter_7/index.html"><strong aria-hidden="true">7.</strong> Wi-Fi Configuration and Connection</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_7/7.1/index.html"><strong aria-hidden="true">7.1.</strong> Basics of Wi-Fi</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_7/7.1/7.1.1.html"><strong aria-hidden="true">7.1.1.</strong> Introduction to Wi-Fi</a></li><li class="chapter-item expanded "><a href="../../chapter_7/7.1/7.1.2.html"><strong aria-hidden="true">7.1.2.</strong> Evolution of IEEE 802.11</a></li><li class="chapter-item expanded "><a href="../../chapter_7/7.1/7.1.3.html"><strong aria-hidden="true">7.1.3.</strong> Wi-Fi Concepts</a></li><li class="chapter-item expanded "><a href="../../chapter_7/7.1/7.1.4.html"><strong aria-hidden="true">7.1.4.</strong> Wi-Fi Connection</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_7/7.2/index.html"><strong aria-hidden="true">7.2.</strong> Basics of Bluetooth</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_7/7.2/7.2.1.html"><strong aria-hidden="true">7.2.1.</strong> Introduction to Bluetooth</a></li><li class="chapter-item expanded "><a href="../../chapter_7/7.2/7.2.2.html"><strong aria-hidden="true">7.2.2.</strong> Bluetooth Concepts</a></li><li class="chapter-item expanded "><a href="../../chapter_7/7.2/7.2.3.html"><strong aria-hidden="true">7.2.3.</strong> Bluetooth Connection</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_7/7.3/index.html"><strong aria-hidden="true">7.3.</strong> Wi-Fi Network Configuration</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_7/7.3/7.3.1.html"><strong aria-hidden="true">7.3.1.</strong> Wi-Fi Network Configuration Guide</a></li><li class="chapter-item expanded "><a href="../../chapter_7/7.3/7.3.2.html"><strong aria-hidden="true">7.3.2.</strong> SoftAP</a></li><li class="chapter-item expanded "><a href="../../chapter_7/7.3/7.3.3.html"><strong aria-hidden="true">7.3.3.</strong> SmartConfig</a></li><li class="chapter-item expanded "><a href="../../chapter_7/7.3/7.3.4.html"><strong aria-hidden="true">7.3.4.</strong> Bluetooth</a></li><li class="chapter-item expanded "><a href="../../chapter_7/7.3/7.3.5.html"><strong aria-hidden="true">7.3.5.</strong> Other Methods</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_7/7.4/index.html"><strong aria-hidden="true">7.4.</strong> Wi-Fi Programming</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_7/7.4/7.4.1.html"><strong aria-hidden="true">7.4.1.</strong> Wi-Fi Components in ESP-IDF</a></li><li class="chapter-item expanded "><a href="../../chapter_7/7.4/7.4.2.html"><strong aria-hidden="true">7.4.2.</strong> Exercise: Wi-Fi Connection</a></li><li class="chapter-item expanded "><a href="../../chapter_7/7.4/7.4.3.html"><strong aria-hidden="true">7.4.3.</strong> Exercise: Smart Wi-Fi Connection</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_7/7.5/index.html"><strong aria-hidden="true">7.5.</strong> üßê Practice: Wi-Fi Configuration in Smart Light Project</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_7/7.5/7.5.1.html"><strong aria-hidden="true">7.5.1.</strong> Wi-Fi Connection in Smart Light Project</a></li><li class="chapter-item expanded "><a href="../../chapter_7/7.5/7.5.2.html"><strong aria-hidden="true">7.5.2.</strong> Smart Wi-Fi Configuration</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_7/summary.html"><strong aria-hidden="true">7.6.</strong> Summary</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_8/index.html"><strong aria-hidden="true">8.</strong> Local Control</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_8/8.1/index.html"><strong aria-hidden="true">8.1.</strong> Introduction to Local Control</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_8/8.1/8.1.1.html"><strong aria-hidden="true">8.1.1.</strong> Application of Local Control</a></li><li class="chapter-item expanded "><a href="../../chapter_8/8.1/8.1.2.html"><strong aria-hidden="true">8.1.2.</strong> Advantages of Local Control</a></li><li class="chapter-item expanded "><a href="../../chapter_8/8.1/8.1.3.html"><strong aria-hidden="true">8.1.3.</strong> Discovering Controlled Devices through Smartphones</a></li><li class="chapter-item expanded "><a href="../../chapter_8/8.1/8.1.4.html"><strong aria-hidden="true">8.1.4.</strong> Data Communication Between Smartphones and Devices</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_8/8.2/index.html"><strong aria-hidden="true">8.2.</strong> Common Local Discovery Methods</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_8/8.2/8.2.1.html"><strong aria-hidden="true">8.2.1.</strong> Broadcast</a></li><li class="chapter-item expanded "><a href="../../chapter_8/8.2/8.2.2.html"><strong aria-hidden="true">8.2.2.</strong> Multicast</a></li><li class="chapter-item expanded "><a href="../../chapter_8/8.2/8.2.3.html"><strong aria-hidden="true">8.2.3.</strong> Comparison Between Broadcast and Multicast</a></li><li class="chapter-item expanded "><a href="../../chapter_8/8.2/8.2.4.html"><strong aria-hidden="true">8.2.4.</strong> Multicast Application Protocol mDNS for Local Discovery</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_8/8.3/index.html"><strong aria-hidden="true">8.3.</strong> Common Communication Protocols for Local Data</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_8/8.3/8.3.1.html"><strong aria-hidden="true">8.3.1.</strong> Transmission Control Protocol (TCP)</a></li><li class="chapter-item expanded "><a href="../../chapter_8/8.3/8.3.2.html"><strong aria-hidden="true">8.3.2.</strong> HyperText Transfer Protocol (HTTP)</a></li><li class="chapter-item expanded "><a href="../../chapter_8/8.3/8.3.3.html"><strong aria-hidden="true">8.3.3.</strong> User Datagram Protocol (UDP)</a></li><li class="chapter-item expanded "><a href="../../chapter_8/8.3/8.3.4.html"><strong aria-hidden="true">8.3.4.</strong> Constrained Application Protocol (CoAP)</a></li><li class="chapter-item expanded "><a href="../../chapter_8/8.3/8.3.5.html" class="active"><strong aria-hidden="true">8.3.5.</strong> Bluetooth Protocol</a></li><li class="chapter-item expanded "><a href="../../chapter_8/8.3/8.3.6.html"><strong aria-hidden="true">8.3.6.</strong> Summary of Data Communication Protocols</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_8/8.4/index.html"><strong aria-hidden="true">8.4.</strong> Guarantee of Data Security</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_8/8.4/8.4.1.html"><strong aria-hidden="true">8.4.1.</strong> Introduction to Transport Layer Security (TLS)</a></li><li class="chapter-item expanded "><a href="../../chapter_8/8.4/8.4.2.html"><strong aria-hidden="true">8.4.2.</strong> Introduction to Datagram Transport Layer Security (DTLS)</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_8/8.5/index.html"><strong aria-hidden="true">8.5.</strong> üßê Practice: Local Control in Smart Light Project</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_8/8.5/8.5.1.html"><strong aria-hidden="true">8.5.1.</strong> Creating a Wi-Fi-based Local Control Server</a></li><li class="chapter-item expanded "><a href="../../chapter_8/8.5/8.5.2.html"><strong aria-hidden="true">8.5.2.</strong> Verifying Local Control Functionality using Scripts</a></li><li class="chapter-item expanded "><a href="../../chapter_8/8.5/8.5.3.html"><strong aria-hidden="true">8.5.3.</strong> Creating a Bluetooth-based Local Control Server</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_8/summary.html"><strong aria-hidden="true">8.6.</strong> Summary</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_9/index.html"><strong aria-hidden="true">9.</strong> Cloud Control</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_9/9.1.html"><strong aria-hidden="true">9.1.</strong> Introduction to Remote Control</a></li><li class="chapter-item expanded "><a href="../../chapter_9/9.2/index.html"><strong aria-hidden="true">9.2.</strong> Cloud Data Communication Protocols</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_9/9.2/9.2.1.html"><strong aria-hidden="true">9.2.1.</strong> MQTT Introduction</a></li><li class="chapter-item expanded "><a href="../../chapter_9/9.2/9.2.2.html"><strong aria-hidden="true">9.2.2.</strong> MQTT Principles</a></li><li class="chapter-item expanded "><a href="../../chapter_9/9.2/9.2.3.html"><strong aria-hidden="true">9.2.3.</strong> MQTT Message Format</a></li><li class="chapter-item expanded "><a href="../../chapter_9/9.2/9.2.4.html"><strong aria-hidden="true">9.2.4.</strong> Protocol Comparison</a></li><li class="chapter-item expanded "><a href="../../chapter_9/9.2/9.2.5.html"><strong aria-hidden="true">9.2.5.</strong> Setting Up MQTT Broker on Linux and Windows</a></li><li class="chapter-item expanded "><a href="../../chapter_9/9.2/9.2.6.html"><strong aria-hidden="true">9.2.6.</strong> Setting Up MQTT Client Based on ESP-IDF</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_9/9.3/index.html"><strong aria-hidden="true">9.3.</strong> Ensuring MQTT Data Security</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_9/9.3/9.3.1.html"><strong aria-hidden="true">9.3.1.</strong> Meaning and Function of Certificates</a></li><li class="chapter-item expanded "><a href="../../chapter_9/9.3/9.3.2.html"><strong aria-hidden="true">9.3.2.</strong> Generating Certificates Locally</a></li><li class="chapter-item expanded "><a href="../../chapter_9/9.3/9.3.3.html"><strong aria-hidden="true">9.3.3.</strong> Configuring MQTT Broker</a></li><li class="chapter-item expanded "><a href="../../chapter_9/9.3/9.3.4.html"><strong aria-hidden="true">9.3.4.</strong> Configuring MQTT Client</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_9/9.4/index.html"><strong aria-hidden="true">9.4.</strong> üßê Practice: Remote Control through ESP RainMaker</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_9/9.4/9.4.1.html"><strong aria-hidden="true">9.4.1.</strong> ESP RainMaker Basics</a></li><li class="chapter-item expanded "><a href="../../chapter_9/9.4/9.4.2.html"><strong aria-hidden="true">9.4.2.</strong> Node and Cloud Backend Communication Protocol</a></li><li class="chapter-item expanded "><a href="../../chapter_9/9.4/9.4.3.html"><strong aria-hidden="true">9.4.3.</strong> Communication between Client and Cloud Backend</a></li><li class="chapter-item expanded "><a href="../../chapter_9/9.4/9.4.4.html"><strong aria-hidden="true">9.4.4.</strong> User Roles</a></li><li class="chapter-item expanded "><a href="../../chapter_9/9.4/9.4.5.html"><strong aria-hidden="true">9.4.5.</strong> Basic Services</a></li><li class="chapter-item expanded "><a href="../../chapter_9/9.4/9.4.6.html"><strong aria-hidden="true">9.4.6.</strong> Smart Light Example</a></li><li class="chapter-item expanded "><a href="../../chapter_9/9.4/9.4.7.html"><strong aria-hidden="true">9.4.7.</strong> RainMaker App and Third-Party Integrations</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_9/summary.html"><strong aria-hidden="true">9.5.</strong> Summary</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_10/index.html"><strong aria-hidden="true">10.</strong> Smartphone App Development</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_10/10.1/index.html"><strong aria-hidden="true">10.1.</strong> Introduction to Smartphone App Development</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_10/10.1/10.1.1.html"><strong aria-hidden="true">10.1.1.</strong> Overview of Smartphone App Development</a></li><li class="chapter-item expanded "><a href="../../chapter_10/10.1/10.1.2.html"><strong aria-hidden="true">10.1.2.</strong> Structure of the Android Project</a></li><li class="chapter-item expanded "><a href="../../chapter_10/10.1/10.1.3.html"><strong aria-hidden="true">10.1.3.</strong> Structure of the iOS Project</a></li><li class="chapter-item expanded "><a href="../../chapter_10/10.1/10.1.4.html"><strong aria-hidden="true">10.1.4.</strong> Lifecycle of an Android Activity</a></li><li class="chapter-item expanded "><a href="../../chapter_10/10.1/10.1.5.html"><strong aria-hidden="true">10.1.5.</strong> Lifecycle of iOS ViewController</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_10/10.2/index.html"><strong aria-hidden="true">10.2.</strong> Creating a New Smartphone App Project</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_10/10.2/10.2.1.html"><strong aria-hidden="true">10.2.1.</strong> Preparing for Android Development</a></li><li class="chapter-item expanded "><a href="../../chapter_10/10.2/10.2.2.html"><strong aria-hidden="true">10.2.2.</strong> Creating a New Android Project</a></li><li class="chapter-item expanded "><a href="../../chapter_10/10.2/10.2.3.html"><strong aria-hidden="true">10.2.3.</strong> Adding Dependencies for MyRainmaker</a></li><li class="chapter-item expanded "><a href="../../chapter_10/10.2/10.2.4.html"><strong aria-hidden="true">10.2.4.</strong> Permission Request in Android</a></li><li class="chapter-item expanded "><a href="../../chapter_10/10.2/10.2.5.html"><strong aria-hidden="true">10.2.5.</strong> Preparing for iOS Development</a></li><li class="chapter-item expanded "><a href="../../chapter_10/10.2/10.2.6.html"><strong aria-hidden="true">10.2.6.</strong> Creating a New iOS Project</a></li><li class="chapter-item expanded "><a href="../../chapter_10/10.2/10.2.7.html"><strong aria-hidden="true">10.2.7.</strong> Adding Dependencies for MyRainmaker</a></li><li class="chapter-item expanded "><a href="../../chapter_10/10.2/10.2.8.html"><strong aria-hidden="true">10.2.8.</strong> Permission Request in iOS</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_10/10.3/index.html"><strong aria-hidden="true">10.3.</strong> Analysis of the App‚Äôs Functional Requirements</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_10/10.3/10.3.1.html"><strong aria-hidden="true">10.3.1.</strong> Analysis of the Project‚Äôs Functional Requirements</a></li><li class="chapter-item expanded "><a href="../../chapter_10/10.3/10.3.2.html"><strong aria-hidden="true">10.3.2.</strong> Analysis of User Management Requirements</a></li><li class="chapter-item expanded "><a href="../../chapter_10/10.3/10.3.3.html"><strong aria-hidden="true">10.3.3.</strong> Analysis of Device Provisioning and Binding Requirements</a></li><li class="chapter-item expanded "><a href="../../chapter_10/10.3/10.3.4.html"><strong aria-hidden="true">10.3.4.</strong> Analysis of Remote-Control Requirements</a></li><li class="chapter-item expanded "><a href="../../chapter_10/10.3/10.3.5.html"><strong aria-hidden="true">10.3.5.</strong> Analysis of Scheduling Requirements</a></li><li class="chapter-item expanded "><a href="../../chapter_10/10.3/10.3.6.html"><strong aria-hidden="true">10.3.6.</strong> Analysis of User Center Requirements</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_10/10.4/index.html"><strong aria-hidden="true">10.4.</strong> Development of User Management</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_10/10.4/10.4.1.html"><strong aria-hidden="true">10.4.1.</strong> Introduction to RainMaker APIs</a></li><li class="chapter-item expanded "><a href="../../chapter_10/10.4/10.4.2.html"><strong aria-hidden="true">10.4.2.</strong> Initiating Communication via Smartphone</a></li><li class="chapter-item expanded "><a href="../../chapter_10/10.4/10.4.3.html"><strong aria-hidden="true">10.4.3.</strong> Account Registration</a></li><li class="chapter-item expanded "><a href="../../chapter_10/10.4/10.4.4.html"><strong aria-hidden="true">10.4.4.</strong> Account Login</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_10/10.5/index.html"><strong aria-hidden="true">10.5.</strong> Development of Device Provisioning</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_10/10.5/10.5.1.html"><strong aria-hidden="true">10.5.1.</strong> Scanning Devices</a></li><li class="chapter-item expanded "><a href="../../chapter_10/10.5/10.5.2.html"><strong aria-hidden="true">10.5.2.</strong> Connecting Devices</a></li><li class="chapter-item expanded "><a href="../../chapter_10/10.5/10.5.3.html"><strong aria-hidden="true">10.5.3.</strong> Generating Secret Keys</a></li><li class="chapter-item expanded "><a href="../../chapter_10/10.5/10.5.4.html"><strong aria-hidden="true">10.5.4.</strong> Getting Node ID</a></li><li class="chapter-item expanded "><a href="../../chapter_10/10.5/10.5.5.html"><strong aria-hidden="true">10.5.5.</strong> Provisioning Devices</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_10/10.6/index.html"><strong aria-hidden="true">10.6.</strong> Development of Device Control</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_10/10.6/10.6.1.html"><strong aria-hidden="true">10.6.1.</strong> Binding Devices to Cloud Accounts</a></li><li class="chapter-item expanded "><a href="../../chapter_10/10.6/10.6.2.html"><strong aria-hidden="true">10.6.2.</strong> Getting a List of Devices</a></li><li class="chapter-item expanded "><a href="../../chapter_10/10.6/10.6.3.html"><strong aria-hidden="true">10.6.3.</strong> Getting Device Status</a></li><li class="chapter-item expanded "><a href="../../chapter_10/10.6/10.6.4.html"><strong aria-hidden="true">10.6.4.</strong> Changing Device Status</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_10/10.7/index.html"><strong aria-hidden="true">10.7.</strong> Development of Scheduling and User Center</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_10/10.7/10.7.1.html"><strong aria-hidden="true">10.7.1.</strong> Implementing Scheduling Function</a></li><li class="chapter-item expanded "><a href="../../chapter_10/10.7/10.7.2.html"><strong aria-hidden="true">10.7.2.</strong> Implementing User Center</a></li><li class="chapter-item expanded "><a href="../../chapter_10/10.7/10.7.3.html"><strong aria-hidden="true">10.7.3.</strong> More Cloud APIs</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_10/summary.html"><strong aria-hidden="true">10.8.</strong> Summary</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_11/index.html"><strong aria-hidden="true">11.</strong> Firmware Upgrade and Version Management</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_11/11.1/index.html"><strong aria-hidden="true">11.1.</strong> Firmware Upgrade</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_11/11.1/11.1.1.html"><strong aria-hidden="true">11.1.1.</strong> Overview of Partition Tables</a></li><li class="chapter-item expanded "><a href="../../chapter_11/11.1/11.1.2.html"><strong aria-hidden="true">11.1.2.</strong> Firmware Boot Process</a></li><li class="chapter-item expanded "><a href="../../chapter_11/11.1/11.1.3.html"><strong aria-hidden="true">11.1.3.</strong> Overview of the OTA Mechanism</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_11/11.2/index.html"><strong aria-hidden="true">11.2.</strong> Firmware Version Management</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_11/11.2/11.2.1.html"><strong aria-hidden="true">11.2.1.</strong> Firmware Marking</a></li><li class="chapter-item expanded "><a href="../../chapter_11/11.2/11.2.2.html"><strong aria-hidden="true">11.2.2.</strong> Rollback and Anti-Rollback</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_11/11.3/index.html"><strong aria-hidden="true">11.3.</strong> üßê Practice: Over-the-air (OTA) Example</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_11/11.3/11.3.1.html"><strong aria-hidden="true">11.3.1.</strong> Upgrade Firmware Through a Local Host</a></li><li class="chapter-item expanded "><a href="../../chapter_11/11.3/11.3.2.html"><strong aria-hidden="true">11.3.2.</strong> Upgrade Firmware Through ESP RainMaker</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_11/summary.html"><strong aria-hidden="true">11.4.</strong> Summary</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Optimisation and Mass Production</li><li class="chapter-item expanded "><a href="../../chapter_12/index.html"><strong aria-hidden="true">12.</strong> Power Management and Low-Power Optimisation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_12/12.1/index.html"><strong aria-hidden="true">12.1.</strong> ESP32-C3 Power Management</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_12/12.1/12.1.1.html"><strong aria-hidden="true">12.1.1.</strong> Dynamic Frequency Scaling</a></li><li class="chapter-item expanded "><a href="../../chapter_12/12.1/12.1.2.html"><strong aria-hidden="true">12.1.2.</strong> Power Management Configuration</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_12/12.2/index.html"><strong aria-hidden="true">12.2.</strong> ESP32-C3 Low-Power Mode</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_12/12.2/12.2.1.html"><strong aria-hidden="true">12.2.1.</strong> Modem-sleep mode</a></li><li class="chapter-item expanded "><a href="../../chapter_12/12.2/12.2.2.html"><strong aria-hidden="true">12.2.2.</strong> Light-sleep Mode</a></li><li class="chapter-item expanded "><a href="../../chapter_12/12.2/12.2.3.html"><strong aria-hidden="true">12.2.3.</strong> Deep-sleep mode</a></li><li class="chapter-item expanded "><a href="../../chapter_12/12.2/12.2.4.html"><strong aria-hidden="true">12.2.4.</strong> Current Consumption in Different Power Modes</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_12/12.3/index.html"><strong aria-hidden="true">12.3.</strong> Power Management and Low-Power Debugging</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_12/12.3/12.3.1.html"><strong aria-hidden="true">12.3.1.</strong> Log Debugging</a></li><li class="chapter-item expanded "><a href="../../chapter_12/12.3/12.3.2.html"><strong aria-hidden="true">12.3.2.</strong> GPIO Debugging</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_12/12.4/index.html"><strong aria-hidden="true">12.4.</strong> Practice: Power Management in Smart Light Project</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_12/12.4/12.4.1.html"><strong aria-hidden="true">12.4.1.</strong> Configuring Power Management Feature</a></li><li class="chapter-item expanded "><a href="../../chapter_12/12.4/12.4.2.html"><strong aria-hidden="true">12.4.2.</strong> Use Power Management Locks</a></li><li class="chapter-item expanded "><a href="../../chapter_12/12.4/12.4.3.html"><strong aria-hidden="true">12.4.3.</strong> Verifying Power Consumption</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_12/summary.html"><strong aria-hidden="true">12.5.</strong> Summary</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_13/index.html"><strong aria-hidden="true">13.</strong> Enhanced Device Security Features</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_13/13.1/index.html"><strong aria-hidden="true">13.1.</strong> Overview of IoT Device Data Security</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_13/13.1/13.1.1.html"><strong aria-hidden="true">13.1.1.</strong> Why Securing IoT Device Data?</a></li><li class="chapter-item expanded "><a href="../../chapter_13/13.1/13.1.2.html"><strong aria-hidden="true">13.1.2.</strong> Basic Requirements for IoT Device Data Security</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_13/13.2/index.html"><strong aria-hidden="true">13.2.</strong> Data Integrity Protection</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_13/13.2/13.2.1.html"><strong aria-hidden="true">13.2.1.</strong> Introduction to Integrity Verification Method</a></li><li class="chapter-item expanded "><a href="../../chapter_13/13.2/13.2.2.html"><strong aria-hidden="true">13.2.2.</strong> Integrity Verification of Firmware Data</a></li><li class="chapter-item expanded "><a href="../../chapter_13/13.2/13.2.3.html"><strong aria-hidden="true">13.2.3.</strong> Example</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_13/13.3/index.html"><strong aria-hidden="true">13.3.</strong> Data Confidentiality Protection</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_13/13.3/13.3.1.html"><strong aria-hidden="true">13.3.1.</strong> Introduction to Data Encryption</a></li><li class="chapter-item expanded "><a href="../../chapter_13/13.3/13.3.2.html"><strong aria-hidden="true">13.3.2.</strong> Introduction to Flash Encryption Scheme</a></li><li class="chapter-item expanded "><a href="../../chapter_13/13.3/13.3.3.html"><strong aria-hidden="true">13.3.3.</strong> Flash Encryption Key Storage</a></li><li class="chapter-item expanded "><a href="../../chapter_13/13.3/13.3.4.html"><strong aria-hidden="true">13.3.4.</strong> Working Mode of Flash Encryption</a></li><li class="chapter-item expanded "><a href="../../chapter_13/13.3/13.3.5.html"><strong aria-hidden="true">13.3.5.</strong> Flash Encryption Process</a></li><li class="chapter-item expanded "><a href="../../chapter_13/13.3/13.3.6.html"><strong aria-hidden="true">13.3.6.</strong> Introduction to NVS Encryption</a></li><li class="chapter-item expanded "><a href="../../chapter_13/13.3/13.3.7.html"><strong aria-hidden="true">13.3.7.</strong> Examples of Flash Encryption and NVS Encryption</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_13/13.4/index.html"><strong aria-hidden="true">13.4.</strong> Data Legitimacy Protection</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_13/13.4/13.4.1.html"><strong aria-hidden="true">13.4.1.</strong> Introduction to Digital Signature</a></li><li class="chapter-item expanded "><a href="../../chapter_13/13.4/13.4.2.html"><strong aria-hidden="true">13.4.2.</strong> Overview of Secure Boot Scheme</a></li><li class="chapter-item expanded "><a href="../../chapter_13/13.4/13.4.3.html"><strong aria-hidden="true">13.4.3.</strong> Introduction to Software Secure Boot</a></li><li class="chapter-item expanded "><a href="../../chapter_13/13.4/13.4.4.html"><strong aria-hidden="true">13.4.4.</strong> Introduction to Hardware Secure Boot</a></li><li class="chapter-item expanded "><a href="../../chapter_13/13.4/13.4.5.html"><strong aria-hidden="true">13.4.5.</strong> Examples</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_13/13.5/index.html"><strong aria-hidden="true">13.5.</strong> Practice: Security Features In Mass Production</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_13/13.5/13.5.1.html"><strong aria-hidden="true">13.5.1.</strong> Flash Encryption and Secure Boot</a></li><li class="chapter-item expanded "><a href="../../chapter_13/13.5/13.5.2.html"><strong aria-hidden="true">13.5.2.</strong> Enabling Flash Encryption and Secure Boot with Batch Flash Tools</a></li><li class="chapter-item expanded "><a href="../../chapter_13/13.5/13.5.3.html"><strong aria-hidden="true">13.5.3.</strong> Enabling Flash Encryption and Secure Boot in Smart Light Project</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_13/summary.html"><strong aria-hidden="true">13.6.</strong> Summary</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_14/index.html"><strong aria-hidden="true">14.</strong> Firmware Burning and Testing for Mass Production</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_14/14.1/index.html"><strong aria-hidden="true">14.1.</strong> Firmware Burning in Mass Production</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_14/14.1/14.1.1.html"><strong aria-hidden="true">14.1.1.</strong> Defining Data Partitions</a></li><li class="chapter-item expanded "><a href="../../chapter_14/14.1/14.1.2.html"><strong aria-hidden="true">14.1.2.</strong> Firmware Burning</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_14/14.2.html"><strong aria-hidden="true">14.2.</strong> Mass Production Testing</a></li><li class="chapter-item expanded "><a href="../../chapter_14/14.3.html"><strong aria-hidden="true">14.3.</strong> Practice: Mass Production Data in Smart Light Project</a></li><li class="chapter-item expanded "><a href="../../chapter_14/summary.html"><strong aria-hidden="true">14.4.</strong> Summary</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_15/index.html"><strong aria-hidden="true">15.</strong> ESP Insights: Remote Monitoring Platform</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_15/15.1.html"><strong aria-hidden="true">15.1.</strong> Introduction to ESP Insights</a></li><li class="chapter-item expanded "><a href="../../chapter_15/15.2/index.html"><strong aria-hidden="true">15.2.</strong> Getting Started with ESP Insights</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../chapter_15/15.2/15.2.1.html"><strong aria-hidden="true">15.2.1.</strong> Getting Started with ESP Insights in the esp-insights Project</a></li><li class="chapter-item expanded "><a href="../../chapter_15/15.2/15.2.2.html"><strong aria-hidden="true">15.2.2.</strong> Running Example in the esp-insights Project</a></li><li class="chapter-item expanded "><a href="../../chapter_15/15.2/15.2.3.html"><strong aria-hidden="true">15.2.3.</strong> Reporting Coredump Information</a></li><li class="chapter-item expanded "><a href="../../chapter_15/15.2/15.2.4.html"><strong aria-hidden="true">15.2.4.</strong> Customising Logs of Interest</a></li><li class="chapter-item expanded "><a href="../../chapter_15/15.2/15.2.5.html"><strong aria-hidden="true">15.2.5.</strong> Reporting Reboot Reason</a></li><li class="chapter-item expanded "><a href="../../chapter_15/15.2/15.2.6.html"><strong aria-hidden="true">15.2.6.</strong> Reporting Custom Metrics</a></li></ol></li><li class="chapter-item expanded "><a href="../../chapter_15/15.3.html"><strong aria-hidden="true">15.3.</strong> Practice: Using ESP Insights in Smart Light Project</a></li><li class="chapter-item expanded "><a href="../../chapter_15/summary.html"><strong aria-hidden="true">15.4.</strong> Summary</a></li></ol></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">ESP32-C3 Wireless Adventure A comprehensive guide to IoT</h1>

                    <div class="right-buttons">
                                                <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        <a href="https://github.com/esp-rs/book" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                                                                        <a href="https://github.com/espressif/esp32-c3-book-en/blob/main/WRITINGS.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>
                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="bluetooth-protocol"><a class="header" href="#bluetooth-protocol">Bluetooth Protocol</a></h1>
<h3 id="1-introduction-to-bluetooth-protocol"><a class="header" href="#1-introduction-to-bluetooth-protocol">1. Introduction to Bluetooth protocol</a></h3>
<p>Chapter 7 introduces the protocol and architecture of Bluetooth. The Bluetooth protocol defines message formats and process for completing specific functions, such as link control, security services, service information exchange and data transmission. This section only introduces the attribute protocol (ATT) of the Bluetooth protocol specification. Bluetooth data exists in the form of attributes, and each attribute consists of four elements.</p>
<h4 id="attribute-handle"><a class="header" href="#attribute-handle">Attribute handle</a></h4>
<p>Just as memory addresses are used to find contents in memory, attribute handles can also help find the corresponding attribute. For example, the first attribute handle is 0x0001, the second attribute handle is 0x0002, and so on, up to a maximum of 0xFFFF.</p>
<h4 id="attribute-uuid"><a class="header" href="#attribute-uuid">Attribute UUID</a></h4>
<p>Each data represents specific property. For example, a smart light has two basic attributes, one for setting the on/off status, and the other for reading the on/off status.</p>
<h4 id="attribute-value"><a class="header" href="#attribute-value">Attribute value</a></h4>
<p>Attribute value is the information that each attribute carries, while the other three elements are to enable the peer to obtain the attribute value much easier. For example, for a smart light, the attribute value for setting the on/off status can be set to &quot;1&quot; to turn on the light, or to &quot;0&quot; to turn off the light; the attribute value for reading the on/off status can be &quot;1&quot; for the &quot;on&quot; status or &quot;0&quot; for the &quot;off&quot; status.</p>
<h4 id="attribute-permissions"><a class="header" href="#attribute-permissions">Attribute permissions</a></h4>
<p>Each attribute has corresponding access restrictions for its own attribute values, such as some attributes are readable, some are writable, and some are readable and writable. The party that owns the data can control the attribute permissions of local data through attribute permissions. For example, the switch attribute permission of the smart light can be set as writable but not readable, and the attribute permission for reading the switch status of the smart light can be set as read-only and not writable.</p>
<p>Table 8.2 lists the Bluetooth attributes for the basic functions of a
smart light.</p>
<p align="center"><i>Table 8.2. Bluetooth attributes for basic functions of smart light</i></p>
<table><thead><tr><th align="center">Attribute handle</th><th align="center">Attribute UUID</th><th align="center">Attribute value</th><th align="center">Attribute permissions</th></tr></thead><tbody>
<tr><td align="center">0x0001</td><td align="center">Set the on/off status</td><td align="center">1/0</td><td align="center">Writable but not readable</td></tr>
<tr><td align="center">0x0002</td><td align="center">Read the on/off status</td><td align="center">1/0</td><td align="center">Readable but not writable</td></tr>
</tbody></table>
<p>The device that stores the data (i.e., attributes) is usually called the <strong>server</strong>, and the device that receives data from other devices is called the <strong>client</strong>. For a smart light and a smartphone, the smart light is server, and the smartphone is the client. The following are common operations between a server and a client:</p>
<ol>
<li>
<p>The client sends data to the server.</p>
<p>Data is transmitted by writing data to the server. There are two
types of write operations: one is <strong>write request</strong>, and the other
is <strong>write command</strong>. The main difference between the two is that
the former requires a response (<strong>write response</strong>) from the peer,
while the latter does not. For a smart light, the command to turn
on/off the light sent by the smartphone is a write operation, and
this is a write request which requires the smart light to respond.
Such response is not a simple ACK response. The result of the action
of turning on/off the light needs to be returned to the smartphone
to inform it of the current status of the smart light.</p>
</li>
<li>
<p>The server sends data to the client.</p>
<p>The updated data is sent from the server to the client mainly in the
form of server <strong>indication</strong> or <strong>notification</strong>. Similar to write
operations, the main difference between indication and notification
is that the former requires the other device to respond
(<strong>confirm</strong>) after receiving the data indication. For a smart
light, if it is turned on/off through a physical switch button, its
status needs to be reported to the smartphone through indications or
notifications, and the smartphone will display the latest status.</p>
</li>
<li>
<p>The client reads data from the server actively.</p>
<p>Generally, the client obtains values of corresponding attributes
from the server through <strong>read operation</strong>. In the case mentioned
above where a smart light is turned on/off through a physical switch
button, except for waiting to be notified by the server, the
smartphone can also obtain the real-time status through read
operations.</p>
</li>
</ol>
<p>Then let's consider which way is better to get the status of the smart light. Active reading takes time whenever the smartphone initiates a read operation, while indication or notification saves the time for repetitive data transmission. It seems that the latter option is faster but if the smart light is not connected to the phone when sending the notification, its status will not be updated. This can be fixed by updating the status as soon as the phone becomes connected to the smart light; otherwise, it is recommended to use the read operation.</p>
<h3 id="2-creating-a-bluetooth-server-using-esp-idf-component"><a class="header" href="#2-creating-a-bluetooth-server-using-esp-idf-component">2. Creating a Bluetooth server using ESP-IDF component</a></h3>
<blockquote>
<p>üìù <strong>Source code</strong></p>
<p>For the source code of Bluetooth, please refer to <a href="https://github.com/espressif/esp-idf/tree/master/examples/provisioning"><code>esp-idf/examples/provisioning/legacy/ble_prov</code></a>. For the example code of customised configuration, please refer to <a href="https://github.com/espressif/esp-idf/tree/master/examples/provisioning"><code>esp-idf/examples/provisioning/legacy/custom_config</code></a>.</p>
</blockquote>
<p>The following example uses the <code>protocomm</code> component to implement the smart light server, and the customised configuration uses the custom-proto protocol. As mentioned earlier, to implement the on/off control and status query of the smart light, two attributes need to be defined. The code is as below:</p>
<pre><code class="language-c">static esp_err_t wifi_prov_config_set_light_handler(uint32_t session_id, const uint8_t *inbuf,
                                                    ssize_t inlen, uint8_t **outbuf,
                                                    ssize_t *outlen, void *priv_data)
{
    CustomConfigRequest *req;
    CustomConfigResponse resp;
    req = custom_config_request_unpack(NULL, inlen, inbuf);
    if (!req) {
        ESP_LOGE(TAG, &quot;Unable to unpack config data&quot;);
        return ESP_ERR_INVALID_ARG;
    }
    custom_config_response_init(&amp;resp);
    resp.status = CUSTOM_CONFIG_STATUS_ConfigFail;
    if (req-&gt;open_light) {//Turn on the smart light
        //Pull up GPIO level according to the status
        ESP_LOGI(TAG, &quot;Open the light&quot;);
    } else {
        //Pull down GPIO level according to the status
        ESP_LOGI(TAG, &quot;Close the light&quot;);
    }

    //Set response status and smart light status according to the light's execution result
    resp.status = CUSTOM_CONFIG_STATUS_ConfigSuccess;
    custom_config_request_free_unpacked(req, NULL);
    resp.light_status = 1; //Respond according to the light status
    *outlen = custom_config_response_get_packed_size(&amp;resp);
    if (*outlen &lt;= 0) {
        ESP_LOGE(TAG, &quot;Invalid encoding for response&quot;);
        return ESP_FAIL;
    }
    *outbuf = (uint8_t *) malloc(*outlen);
    if (*outbuf == NULL) {
        ESP_LOGE(TAG, &quot;System out of memory&quot;);
        return ESP_ERR_NO_MEM;
    }

    custom_config_response_pack(&amp;resp, *outbuf);
    return ESP_OK;
}

static int wifi_prov_config_get_light_handler(uint32_t session_id, const uint8_t *inbuf,
                                              ssize_t inlen, uint8_t **outbuf,
                                              ssize_t *outlen, void *priv_data)
{
    CustomConfigResponse resp;
    custom_config_response_init(&amp;resp);
    resp.status = CUSTOM_CONFIG_STATUS_ConfigSuccess;
    resp.light_status = 1; //Respond according to the light status
    *outlen = custom_config_response_get_packed_size(&amp;resp);
    if (*outlen &lt;= 0) {
        ESP_LOGE(TAG, &quot;Invalid encoding for response&quot;);
        return ESP_FAIL;
    }
    *outbuf = (uint8_t *) malloc(*outlen);
    if (*outbuf == NULL) {
        ESP_LOGE(TAG, &quot;System out of memory&quot;);
        return ESP_ERR_NO_MEM;
    }
    custom_config_response_pack(&amp;resp, *outbuf);
    return ESP_OK;`
}

static esp_err_t app_prov_start_service(void)
{
    //Create protocomm
    g_prov-&gt;pc = protocomm_new();
    if (g_prov-&gt;pc == NULL) {
        ESP_LOGE(TAG, &quot;Failed to create new protocomm instance&quot;);
        return ESP_FAIL;
    }

    //Attribute value
    protocomm_ble_name_uuid_t nu_lookup_table[] = {
        {&quot;prov-session&quot;, 0x0001},
        {&quot;prov-config&quot;, 0x0002},
        {&quot;proto-ver&quot;, 0x0003},
        {&quot;set-light&quot;, 0x0004}, //Set the state of the smart light
        {&quot;get-light&quot;, 0x0005}, //Get the status of the smart light
    };

    //Bluetooth configuration
    protocomm_ble_config_t config = {
        .service_uuid = {
            /* LSB &lt;---------------------------------------
            * ---------------------------------------&gt; MSB */
            0xb4, 0xdf, 0x5a, 0x1c, 0x3f, 0x6b, 0xf4, 0xbf,
            0xea, 0x4a, 0x82, 0x03, 0x04, 0x90, 0x1a, 0x02,
        },
        .nu_lookup_count=sizeof(nu_lookup_table)/sizeof(nu_lookup_table[0]),
        .nu_lookup = nu_lookup_table
    };

    uint8_t eth_mac[6];
    esp_wifi_get_mac(WIFI_IF_STA, eth_mac);
    snprintf(config.device_name, sizeof(config.device_name), &quot;%s%02X%02X%02X&quot;,
            ssid_prefix, eth_mac[3], eth_mac[4], eth_mac[5]);

    //Release BT memory as only Bluetooth LE protocol stack is used.
    esp_err_t err = esp_bt_controller_mem_release(ESP_BT_MODE_CLASSIC_BT);
    if (err) {
        ESP_LOGE(TAG, &quot;bt_controller_mem_release failed %d&quot;, err);
        if (err ! = ESP_ERR_INVALID_STATE) {
            return err;
        }
    }
    //Start protocomm Bluetooth LE protocol stack
    if (protocomm_ble_start(g_prov-&gt;pc, &amp;config) ! = ESP_OK) {
        ESP_LOGE(TAG, &quot;Failed to start BLE provisioning&quot;);
        return ESP_FAIL;
    }
    //Set protocomm version verification endpoint for the protocol
    protocomm_set_version(g_prov-&gt;pc, &quot;proto-ver&quot;, &quot;V0.1&quot;);
    //Set protocomm security type for the endpoint
    if (g_prov-&gt;security == 0) {
        protocomm_set_security(g_prov-&gt;pc, &quot;prov-session&quot;,
                               &amp;protocomm_security0, NULL);
    } else if (g_prov-&gt;security == 1) {
        protocomm_set_security(g_prov-&gt;pc, &quot;prov-session&quot;,
                               &amp;protocomm_security1, g_prov-&gt;pop);
    }
    //Add an endpoint for Wi-Fi configuration
    if(protocomm_add_endpoint(g_prov-&gt;pc, &quot;prov-config&quot;,
                              wifi_prov_config_data_handler,
                              (void *) &amp;wifi_prov_handlers) ! =ESP_OK){
        ESP_LOGE(TAG, &quot;Failed to set provisioning endpoint&quot;);
        protocomm_ble_stop(g_prov-&gt;pc);
        return ESP_FAIL;
    }
    //Add an endpoint for setting smart light status
    if (protocomm_add_endpoint(g_prov-&gt;pc, &quot;set-light&quot;,
                               wifi_prov_config_set_light_handler,
                               NULL) ! = ESP_OK) {
        ESP_LOGE(TAG, &quot;Failed to set set-light endpoint&quot;);
        protocomm_ble_stop(g_prov-&gt;pc);
        return ESP_FAIL;
    }
    //Add an endpoint for getting smart light status
    if (protocomm_add_endpoint(g_prov-&gt;pc, &quot;get-light&quot;,
                               wifi_prov_config_get_light_handler,
                               NULL) ! = ESP_OK) {
        ESP_LOGE(TAG, &quot;Failed to set get-light endpoint&quot;);
        protocomm_ble_stop(g_prov-&gt;pc);
        return ESP_FAIL;
    }
    ESP_LOGI(TAG, &quot;Provisioning started with BLE devname : '%s'&quot;, config.device_name);
    return ESP_OK;
}
</code></pre>
<p>The above example provides two attributes: <code>set-light</code> and <code>get-light</code>,
and the corresponding attribute handles are 0x0004 and 0x0005,
respectively. When the smartphone sends a command to set the light, the
<code>wifi_prov_config_set_light_handler()</code> callback function will be
executed to handle the on/off action and inform the smartphone of the
current status of the smart light. When the smartphone sends a read
command, the <code>wifi_prov_config_get_light_handler()</code> callback function
will be executed to inform the smartphone of the current status of the
smart light. You can use the Bluetooth debugging assistant of the
smartphone to scan the devices connected to Bluetooth, and understand
the function of each service more intuitively through the services
provided by the Bluetooth device.</p>
<p>The above example implements local control via Bluetooth based on the
<code>protocomm</code> component, and the data structure is relatively complex. If
you are an experienced developer, you can try to use the ideas of the
above example to implement local control. In addition, this book
provides the most basic server example based on Bluetooth for beginners.
You can refer to the example code in subsection 8.5.3 to understand the
process of local control using Bluetooth.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                                                    <a rel="prev" href="../../chapter_8/8.3/8.3.4.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        
                                                    <a rel="next" href="../../chapter_8/8.3/8.3.6.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                                    <a rel="prev" href="../../chapter_8/8.3/8.3.4.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                
                                    <a rel="next" href="../../chapter_8/8.3/8.3.6.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        
    </body>
</html>
